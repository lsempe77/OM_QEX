# PHASE 1: TABLE DISCOVERY PROMPT

You are analyzing a research paper in TEI XML format (generated by GROBID from a PDF).

## YOUR TASK

Find EVERY table mentioned or embedded in this paper, regardless of where it appears in the XML structure.

## WHERE TO LOOK

Tables can appear in multiple forms:

1. **Structured tables** in `<figure type="table">` tags:
   ```xml
   <figure type="table" xml:id="tab_1">
     <label>Table 7</label>
     <head>: Project impact on non-farm business activities</head>
     <table>
       <row><cell>Variables</cell><cell>(1)</cell></row>
     </table>
   </figure>
   ```

2. **Paragraph-embedded tables** in `<p>` tags (CRITICAL - often missed):
   ```xml
   <p xml:id="_MzT7dfy">Table 6: Project impact on saving and loans (1) (2) (3) 
   Variables Saving uptake Amount savings Project 0.263*** 4,408*** ...</p>
   ```

3. **Text references** like:
   - "Table 6: Project impact on..."
   - "see Table A1 in Appendix"
   - "Results are shown in Table 3"

4. **Tables in any other location** (front matter, appendices, etc.)

## WHAT TO EXTRACT

For each table you find, extract:

1. **table_number**: The table's number or identifier
   - Examples: "6", "7", "A1", "B2", "1a", "1b"
   - Must be a string (not integer)

2. **title**: The table's caption or title
   - Full text after "Table X:"
   - If no explicit title, use first 50 chars of content
   - Example: "Project impact on saving and loans"

3. **location**: Where you found this table
   - For `<figure>`: "figure" + xml:id attribute
   - For `<p>`: "paragraph" + xml:id attribute  
   - For text reference: "text_reference" + section name
   - Examples: "figure tab_1", "paragraph p_MzT7dfy", "text_reference section_5"

4. **xml_id**: The XML id attribute (if available)
   - From `xml:id="..."` attribute
   - Use null if not available

5. **has_structure**: Boolean indicating if table has explicit XML structure
   - true: Has `<table><row><cell>` tags
   - false: Embedded in paragraph or plain text

6. **confidence**: Your confidence this is actually a table (0.0-1.0)
   - 1.0: Clearly a table with structure or "Table X:" label
   - 0.8: Mentions "Table X" and has numeric content
   - 0.6: Looks like tabular data but no explicit "Table X" label
   - 0.4: Text reference only, no content found

## CRITICAL RULES

⚠️ **DO NOT skip paragraph-embedded tables!**
Many papers have tables like this:
```
<p>Table 6: Project impact on saving and loans (1) (2) (3) (4)
Variables Saving uptake Amount savings Loan uptake Amount loan
Project 0.263*** 4,408*** 0.186** 2,018**
Lump-sum plus training 0.339*** 5,237*** 0.171*** 3,005***
</p>
```
These ARE tables even though they lack `<figure>` tags!

⚠️ **Look for these patterns:**
- "Table \d+:"
- "Table [A-Z]\d+:"
- "\d+\.\d+ Table"
- "See Table"
- "shown in Table"

⚠️ **Validate table numbers:**
- Tables should be numbered sequentially (1, 2, 3...) or (A1, A2, A3...)
- If you find Table 5 and Table 7 but no Table 6, mark this with a warning
- Appendix tables often use "A1", "B1" numbering

## OUTPUT FORMAT

Return ONLY valid JSON (no markdown, no code blocks):

```json
{
  "tables_found": [
    {
      "table_number": "6",
      "title": "Project impact on saving and loans",
      "location": "paragraph p_MzT7dfy",
      "xml_id": "p_MzT7dfy",
      "has_structure": false,
      "confidence": 1.0
    },
    {
      "table_number": "7",
      "title": "Project impact on non-farm business activities",
      "location": "figure tab_1",
      "xml_id": "tab_1",
      "has_structure": true,
      "confidence": 1.0
    }
  ],
  "total_tables_found": 7,
  "table_numbers": ["6", "7", "8", "20", "21", "22", "A1"],
  "warnings": [
    "Table 6 found in paragraph tag (may be hard to parse)",
    "Gap in numbering: found Table 7 but no Table 1-5"
  ],
  "summary": {
    "structured_tables": 6,
    "paragraph_tables": 1,
    "text_references_only": 0
  }
}
```

## EXAMPLES

### Example 1: Structured Table
```xml
<figure type="table" xml:id="tab_0">
  <label>Table 1</label>
  <head>Baseline characteristics</head>
  <table>
    <row><cell>Variable</cell><cell>Mean</cell></row>
  </table>
</figure>
```

Output:
```json
{
  "table_number": "1",
  "title": "Baseline characteristics",
  "location": "figure tab_0",
  "xml_id": "tab_0",
  "has_structure": true,
  "confidence": 1.0
}
```

### Example 2: Paragraph Table (CRITICAL!)
```xml
<p xml:id="_abc123">Table 5: Treatment effects on consumption (1) (2) (3)
Variables Food Non-food Total Project 0.45** 0.23 0.68*** (0.18) (0.15) (0.21)</p>
```

Output:
```json
{
  "table_number": "5",
  "title": "Treatment effects on consumption",
  "location": "paragraph _abc123",
  "xml_id": "_abc123",
  "has_structure": false,
  "confidence": 1.0
}
```

### Example 3: Text Reference Only
```xml
<p>The results are presented in Table 12, which shows significant impacts.</p>
```

Output:
```json
{
  "table_number": "12",
  "title": "Referenced but content not found in this section",
  "location": "text_reference section_results",
  "xml_id": null,
  "has_structure": false,
  "confidence": 0.4
}
```

## VERIFICATION CHECKLIST

Before returning your JSON, verify:

✓ Did I search the ENTIRE document (not just first few sections)?
✓ Did I check both `<figure>` AND `<p>` tags?
✓ Did I look for "Table X:" pattern in paragraph text?
✓ Are table numbers in a reasonable sequence?
✓ Did I flag any gaps in table numbering?
✓ Did I count tables correctly in the summary?
✓ Is my JSON valid (no syntax errors)?

## NOW ANALYZE THE PAPER

TEI XML content follows below. Read it carefully and find ALL tables.
